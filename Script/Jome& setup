document.addEventListener('DOMContentLoaded', () => {
    
    // === 1. 时钟逻辑 ===
    function updateClock() {
        const now = new Date();
        const seconds = now.getSeconds();
        const minutes = now.getMinutes();
        const hours = now.getHours();

        const secondDegrees = ((seconds / 60) * 360);
        const minuteDegrees = ((minutes / 60) * 360) + ((seconds/60)*6);
        const hourDegrees = ((hours / 12) * 360) + ((minutes/60)*30);

        const sHand = document.getElementById('secondHand');
        const mHand = document.getElementById('minuteHand');
        const hHand = document.getElementById('hourHand');

        if(sHand) sHand.style.transform = `translateX(-50%) rotate(${secondDegrees}deg)`;
        if(mHand) mHand.style.transform = `translateX(-50%) rotate(${minuteDegrees}deg)`;
        if(hHand) hHand.style.transform = `translateX(-50%) rotate(${hourDegrees}deg)`;

        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const dayNames = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
        const day = dayNames[now.getDay()];

        const dateDisp = document.getElementById('dateDisplay');
        if(dateDisp) dateDisp.innerHTML = `${year}年${month}月${date}日<br>${day}`;
    }
    
    // 启动时钟
    setInterval(updateClock, 1000);
    updateClock();


    // === 2. 设定弹窗 (Modal) 逻辑 ===
    const btnSettings = document.getElementById('btn-settings');
    const modalSettings = document.getElementById('settings-modal');
    const btnClose = document.getElementById('close-settings');

    if (btnSettings && modalSettings && btnClose) {
        // 打开
        btnSettings.addEventListener('click', () => {
            modalSettings.classList.add('active');
        });

        // 关闭 (点击X)
        btnClose.addEventListener('click', () => {
            modalSettings.classList.remove('active');
        });

        // 关闭 (点击遮罩)
        modalSettings.addEventListener('click', (e) => {
            if (e.target === modalSettings) {
                modalSettings.classList.remove('active');
            }
        });
    }


    // === 3. 页面视图切换逻辑 (View Switcher) ===
    // 这是一个全局函数，可以在 HTML 的 onclick 中直接调用
    window.switchView = function(viewId) {
        // 1. 找到所有带 .view 类的元素
        const views = document.querySelectorAll('.view');
        
        // 2. 遍历隐藏所有页面
        views.forEach(view => {
            view.classList.remove('active');
            view.classList.add('hidden');
        });

        // 3. 显示目标页面
        const targetView = document.getElementById(viewId);
        if (targetView) {
            targetView.classList.remove('hidden');
            targetView.classList.add('active');
        } else {
            console.error(`未找到ID为 ${viewId} 的页面`);
        }
    };
});

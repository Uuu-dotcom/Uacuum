ã€‘ä¸Šä¸‹æ–‡é•¿åº¦æ»‘å— -->
                <div class="form-group">
                    <label class="form-label">ä¸Šä¸‹æ–‡é•¿åº¦ (Context Length)</label>
                    <div class="slider-container">
                        <input type="range" id="contextLength" class="slider" min="10" max="100" value="30" step="1">
                        <div class="slider-value" id="contextLengthValue">30</div>
                    </div>
                    <div class="info-text">AIèƒ½çœ‹åˆ°æœ€è¿‘çš„Næ¡æ¶ˆæ¯ã€‚æ•°å€¼è¶Šå¤§è®°æ€§è¶Šå¥½ï¼Œä½†æ¶ˆè€—ä¹Ÿè¶Šå¤šã€‚</div>
                </div>
                
                <button class="btn success btn-full" id="saveParams">ä¿å­˜å‚æ•°</button>
            </div>

            <div class="settings-section">
                <div class="section-title">æ¶ˆæ¯é€šçŸ¥</div>
                <div class="form-group">
                    <label class="form-label">ç³»ç»Ÿæ¨é€</label>
                    <div class="toggle-container">
                        <div class="toggle" id="notificationToggle">
                            <div class="toggle-thumb"></div>
                        </div>
                        <span class="status-text" id="notificationStatus">å·²å…³é—­</span>
                    </div>
                    <div class="info-text">å…è®¸ AI ä¸»åŠ¨å‘ä½ å‘é€æ¶ˆæ¯æ—¶å¼¹çª—é€šçŸ¥</div>
                </div>
                <button class="btn warning btn-full" id="testNotification">å‘é€æµ‹è¯•é€šçŸ¥</button>
            </div>

            <div class="settings-section">
                <div class="section-title">æ•°æ®å¤‡ä»½</div>
                <div class="button-group">
                    <button class="btn success" id="exportData">å¯¼å‡ºæ•°æ®</button>
                    <button class="btn primary" id="importData">å¯¼å…¥æ•°æ®</button>
                </div>
                <input type="file" id="importFile" accept=".json" style="display: none;">
                <div class="info-text" style="margin-top: 10px; border-top: 2px dashed #ccc; padding-top: 5px;">
                    å±é™©æ“ä½œåŒº
                </div>
                <button class="btn danger btn-full" id="clearData">æ¸…é™¤æ‰€æœ‰æ•°æ® (é‡ç½®)</button>
            </div>
        </div>
    </div>

    <script>
        // DOM å…ƒç´ 
        const phoneContainer = document.getElementById('phoneContainer');
        const apiUrlInput = document.getElementById('apiUrl');
        const apiKeyInput = document.getElementById('apiKey');
        const modelSelect = document.getElementById('modelSelect');
        const tempSlider = document.getElementById('temperature');
        const tempValueDisplay = document.getElementById('tempValue');
        const notifToggle = document.getElementById('notificationToggle');
        const notifStatus = document.getElementById('notificationStatus');
        
        // ã€æ–°å¢ã€‘è·å–ä¸Šä¸‹æ–‡æ»‘å—å…ƒç´ 
        const contextSlider = document.getElementById('contextLength');
        const contextValueDisplay = document.getElementById('contextLengthValue');

        const colorSchemes = ['color-scheme-1', 'color-scheme-2', 'color-scheme-3', 'color-scheme-4', 'color-scheme-5', 'color-scheme-6'];

        window.addEventListener('DOMContentLoaded', () => {
            loadAllSettings();
        });

        function loadAllSettings() {
            const savedColor = localStorage.getItem('phoneColor');
            if (savedColor !== null) {
                phoneContainer.className = 'phone-container ' + colorSchemes[parseInt(savedColor)];
            }
            apiUrlInput.value = localStorage.getItem('apiUrl') || '';
            apiKeyInput.value = localStorage.getItem('apiKey') || '';
            
            const savedModels = localStorage.getItem('modelList');
            const savedSelectedModel = localStorage.getItem('selectedModel');
            if (savedModels) {
                try {
                    const models = JSON.parse(savedModels);
                    updateModelSelectUI(models, savedSelectedModel);
                } catch (e) { console.error('æ¨¡å‹åˆ—è¡¨è§£æå¤±è´¥', e); }
            }

            const savedTemp = localStorage.getItem('temperature') || '9';
            tempSlider.value = savedTemp;
            tempValueDisplay.textContent = (parseInt(savedTemp) / 10).toFixed(1);

            // ã€æ–°å¢ã€‘åŠ è½½å·²ä¿å­˜çš„ä¸Šä¸‹æ–‡é•¿åº¦
            const savedContext = localStorage.getItem('contextLength') || '30'; // é»˜è®¤30
            contextSlider.value = savedContext;
            contextValueDisplay.textContent = savedContext;

            const notifEnabled = localStorage.getItem('notificationEnabled') === 'true';
            if (notifEnabled) {
                notifToggle.classList.add('active');
                notifStatus.textContent = 'å·²å¼€å¯';
            }
        }

        // æ»‘å—äº¤äº’
        tempSlider.addEventListener('input', (e) => {
            tempValueDisplay.textContent = (parseInt(e.target.value) / 10).toFixed(1);
        });
        
        // ã€æ–°å¢ã€‘ä¸Šä¸‹æ–‡æ»‘å—äº¤äº’
        contextSlider.addEventListener('input', (e) => {
            contextValueDisplay.textContent = e.target.value;
        });

        document.getElementById('saveParams').addEventListener('click', () => {
            localStorage.setItem('temperature', tempSlider.value);
            // ã€æ–°å¢ã€‘ä¿å­˜ä¸Šä¸‹æ–‡é•¿åº¦
            localStorage.setItem('contextLength', contextSlider.value);
            alert('å‚æ•°å·²ä¿å­˜ï¼');
        });

        // --- å…¶ä»–JSä»£ç ä¿æŒä¸å˜ ---
        function updateModelSelectUI(models, selected = '') {
            modelSelect.innerHTML = '';
            if (!models || models.length === 0) {
                modelSelect.innerHTML = '<option value="">æš‚æ— æ¨¡å‹</option>';
                return;
            }
            models.forEach(modelId => {
                const opt = document.createElement('option');
                opt.value = modelId;
                opt.textContent = modelId;
                if (modelId === selected) opt.selected = true;
                modelSelect.appendChild(opt);
            });
        }
        document.getElementById('refreshModels').addEventListener('click', async () => {
            const url = apiUrlInput.value.trim();
            const key = apiKeyInput.value.trim();
            if (!url || !key) { alert('è¯·å…ˆå¡«å†™å®Œæ•´çš„ URL å’Œ Key'); return; }
            const btn = document.getElementById('refreshModels');
            btn.disabled = true;
            btn.textContent = 'è¿æ¥ä¸­...';
            try {
                let baseUrl = url.endsWith('/') ? url.slice(0, -1) : url;
                const requestUrl = `${baseUrl}/models`;
                const res = await fetch(requestUrl, { method: 'GET', headers: { 'Authorization': `Bearer ${key}` } });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                const list = data.data || data;
                if (Array.isArray(list)) {
                    const models = list.map(m => m.id);
                    localStorage.setItem('modelList', JSON.stringify(models));
                    updateModelSelectUI(models, modelSelect.value);
                    alert(`æˆåŠŸè·å– ${models.length} ä¸ªæ¨¡å‹`);
                } else { alert('è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®'); }
            } catch (err) { alert('è·å–å¤±è´¥: ' + err.message + '\nè¯·æ£€æŸ¥URLæœ«å°¾æ˜¯å¦éœ€è¦åŠ  /v1'); } 
            finally { btn.disabled = false; btn.textContent = 'åˆ·æ–°æ¨¡å‹'; }
        });
        document.getElementById('saveApi').addEventListener('click', () => {
            localStorage.setItem('apiUrl', apiUrlInput.value.trim());
            localStorage.setItem('apiKey', apiKeyInput.value.trim());
            localStorage.setItem('selectedModel', modelSelect.value);
            alert('API é…ç½®å·²ä¿å­˜');
        });
        notifToggle.addEventListener('click', async () => {
            const isActive = notifToggle.classList.contains('active');
            if (!isActive) {
                if (!('Notification' in window)) { alert('æ­¤æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½'); return; }
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    notifToggle.classList.add('active');
                    notifStatus.textContent = 'å·²å¼€å¯';
                    localStorage.setItem('notificationEnabled', 'true');
                } else { alert('é€šçŸ¥æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸'); }
            } else {
                notifToggle.classList.remove('active');
                notifStatus.textContent = 'å·²å…³é—­';
                localStorage.setItem('notificationEnabled', 'false');
            }
        });
        document.getElementById('testNotification').addEventListener('click', () => {
            if (localStorage.getItem('notificationEnabled') !== 'true') { alert('è¯·å…ˆå¼€å¯ä¸Šæ–¹å¼€å…³'); return; }
            new Notification('åƒç´ æ‰‹æœºé€šçŸ¥æµ‹è¯•', { body: 'å¦‚æœä½ çœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œè¯´æ˜é€šçŸ¥åŠŸèƒ½æ­£å¸¸ï¼ğŸ“±', icon: 'app-icon.png' });
        });
        document.getElementById('exportData').addEventListener('click', () => {
            const allData = {};
            for (let i = 0; i < localStorage.length; i++) { const key = localStorage.key(i); allData[key] = localStorage.getItem(key); }
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pixel-phone-backup-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });
        document.getElementById('importData').addEventListener('click', () => { document.getElementById('importFile').click(); });
        document.getElementById('importFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (confirm('è¿™å°†è¦†ç›–å½“å‰çš„è®¾ç½®å’Œè®°å½•ï¼Œç¡®å®šå—ï¼Ÿ')) {
                        Object.keys(importedData).forEach(key => { localStorage.setItem(key, importedData[key]); });
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°...');
                        location.reload();
                    }
                } catch (err) { alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼å¿…é¡»æ˜¯ json æ–‡ä»¶'); }
            };
            reader.readAsText(file);
        });
        document.getElementById('clearData').addEventListener('click', () => {
            if (confirm('âš ï¸ è­¦å‘Šï¼šè¿™å°†åˆ é™¤æ‰€æœ‰èŠå¤©è®°å½•ã€è”ç³»äººå’Œè®¾ç½®ï¼\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼')) {
                localStorage.clear();
                alert('æ‰‹æœºå·²é‡ç½®ä¸ºå‡ºå‚è®¾ç½®ã€‚');
                location.href = './index.html';
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Settings - Uacuum</title>
    <link rel="stylesheet" href="base.css">
    <style>
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #444; }
        .back-button { background: #fff; border: 3px solid #000; padding: 8px 10px; font-family: 'Press Start 2P', cursive; font-size: 8px; cursor: pointer; box-shadow: 3px 3px 0 #000; }
        .back-button:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #000; }
        .page-title { font-size: 10px; color: #fff; text-shadow: 2px 2px 0 #000; }
        .action-btn { width: 40px; visibility: hidden; } /* å ä½ */

        .content { padding: 0 5px; }
        .setting-group { margin-bottom: 20px; }
        .setting-title { font-size: 8px; color: #fff; margin-bottom: 8px; text-shadow: 1px 1px 0 #000; }
        .input-field, .select-field { width: 100%; padding: 10px; font-size: 8px; border: 2px solid #000; font-family: inherit; margin-bottom: 5px; }
        .fetch-button, .save-button, .clear-button { width: 100%; padding: 12px; font-size: 8px; border: 3px solid #000; font-family: 'Press Start 2P', cursive; cursor: pointer; box-shadow: 3px 3px 0 #000; margin-top: 5px; }
        .fetch-button:active, .save-button:active, .clear-button:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #000; }
        .fetch-button { background-color: #a8e6cf; }
        .save-button { background-color: #4ecdc4; }
        .clear-button { background-color: #ff6b6b; margin-top: 15px; }
        
        .status-message { font-size: 7px; margin-top: 5px; text-align: center; display: none; }
        .status-message.success { color: #a8e6cf; }
        .status-message.error { color: #ff6b6b; word-break: break-all; }

        .slider-container { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .slider { flex-grow: 1; }
        .slider-value { font-size: 8px; color: #fff; min-width: 25px; text-align: right; }
        .color-palette { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-top: 10px; }
        .color-swatch { width: 100%; padding-bottom: 100%; border: 2px solid #000; cursor: pointer; }
        .color-swatch.selected { border: 4px solid #fff; box-shadow: 0 0 5px #fff; }
        .color-scheme-1 { background: #ff6b9d; } .color-scheme-2 { background: #4ecdc4; } .color-scheme-3 { background: #ffe66d; } .color-scheme-4 { background: #a8e6cf; } .color-scheme-5 { background: #ffd3b6; } .color-scheme-6 { background: #c7ceea; }
        textarea.input-field { height: 80px; resize: vertical; }
    </style>
</head>
<body>
    <div class="phone-container" id="phoneContainer">
        <div class="header">
            <button class="back-button" onclick="window.location.href='./index.html'">â† è¿”å›</button>
            <div class="page-title">ç³»ç»Ÿè®¾ç½®</div>
            <div class="action-btn"></div>
        </div>

        <div class="content">
            <!-- API è®¾ç½® -->
            <div class="setting-group">
                <div class="setting-title">API è®¾ç½®</div>
                <input type="text" id="apiUrl" class="input-field" placeholder="API URL (ä¾‹å¦‚: https://api.openai.com/v1)">
                <input type="password" id="apiKey" class="input-field" placeholder="API Key (ä¾‹å¦‚: sk-...)">
                <button id="fetchModels" class="fetch-button">è·å–æ¨¡å‹åˆ—è¡¨</button>
                <select id="modelSelect" class="select-field"></select>
                <div id="apiStatus" class="status-message"></div>
            </div>

            <!-- å¯¹è¯è®¾ç½® -->
            <div class="setting-group">
                <div class="setting-title">å¯¹è¯å‚æ•°</div>
                <label for="temperature" class="setting-title" style="margin-top:10px;">Temperature (éšæœºæ€§)</label>
                <div class="slider-container">
                    <input type="range" id="temperature" class="slider" min="0" max="20" step="1">
                    <span id="tempValue" class="slider-value">0.9</span>
                </div>
            </div>

            <!-- ä¸ªäººè®¾å®š -->
            <div class="setting-group">
                <div class="setting-title">User Persona (ä½ çš„è®¾å®š)</div>
                <textarea id="userPersona" class="input-field" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„è®¾å®šï¼ŒAIåœ¨å›å¤æ—¶ä¼šå‚è€ƒè¿™é‡Œçš„å†…å®¹ã€‚"></textarea>
            </div>

            <!-- å¤–è§‚è®¾ç½® -->
            <div class="setting-group">
                <div class="setting-title">ä¸»é¢˜é¢œè‰²</div>
                <div id="colorPalette" class="color-palette"></div>
            </div>

            <button id="saveSettings" class="save-button">ä¿å­˜æ‰€æœ‰è®¾ç½®</button>
            <button id="clearCache" class="clear-button">æ¸…é™¤æ‰€æœ‰èŠå¤©è®°å½•</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM å…ƒç´ 
            const apiUrlInput = document.getElementById('apiUrl');
            const apiKeyInput = document.getElementById('apiKey');
            const fetchModelsBtn = document.getElementById('fetchModels');
            const modelSelect = document.getElementById('modelSelect');
            const apiStatus = document.getElementById('apiStatus');
            const saveBtn = document.getElementById('saveSettings');
            const tempSlider = document.getElementById('temperature');
            const tempValue = document.getElementById('tempValue');
            const userPersonaInput = document.getElementById('userPersona');
            const phoneContainer = document.getElementById('phoneContainer');
            const colorPalette = document.getElementById('colorPalette');
            const clearCacheBtn = document.getElementById('clearCache');
            const colorSchemes = ['color-scheme-1', 'color-scheme-2', 'color-scheme-3', 'color-scheme-4', 'color-scheme-5', 'color-scheme-6'];

            // åŠ è½½å·²æœ‰è®¾ç½®
            function loadSettings() {
                apiUrlInput.value = localStorage.getItem('apiUrl') || '';
                apiKeyInput.value = localStorage.getItem('apiKey') || '';
                const savedModel = localStorage.getItem('selectedModel');
                if (savedModel) {
                     // é¢„å…ˆå¡«å……ä¸€ä¸ªé€‰é¡¹ï¼Œå³ä½¿ç”¨æˆ·ä¸ç‚¹â€œè·å–â€ä¹Ÿèƒ½çœ‹åˆ°ä¸Šæ¬¡çš„é€‰æ‹©
                    modelSelect.innerHTML = `<option value="${savedModel}">${savedModel}</option>`;
                }
                const savedTemp = localStorage.getItem('temperature') || '9'; // é»˜è®¤å€¼'9' -> 0.9
                tempSlider.value = savedTemp;
                tempValue.textContent = (savedTemp / 10.0).toFixed(1);
                userPersonaInput.value = localStorage.getItem('user_persona') || '';
                
                const savedColor = localStorage.getItem('phoneColor') || '1';
                phoneContainer.className = 'phone-container ' + colorSchemes[parseInt(savedColor)];
                renderPalette(parseInt(savedColor));
            }

            // æ¸©åº¦æ»‘å—
            tempSlider.addEventListener('input', () => {
                tempValue.textContent = (tempSlider.value / 10.0).toFixed(1);
            });

            // æ¸²æŸ“è°ƒè‰²æ¿
            function renderPalette(selectedIndex) {
                colorPalette.innerHTML = '';
                colorSchemes.forEach((scheme, index) => {
                    const swatch = document.createElement('div');
                    swatch.className = `color-swatch ${scheme}`;
                    if (index === selectedIndex) {
                        swatch.classList.add('selected');
                    }
                    swatch.dataset.index = index;
                    swatch.addEventListener('click', () => {
                        localStorage.setItem('phoneColor', index);
                        phoneContainer.className = 'phone-container ' + colorSchemes[index];
                        renderPalette(index);
                    });
                    colorPalette.appendChild(swatch);
                });
            }

            // ä¿å­˜è®¾ç½®
            saveBtn.addEventListener('click', () => {
                localStorage.setItem('apiUrl', apiUrlInput.value.trim());
                localStorage.setItem('apiKey', apiKeyInput.value.trim());
                if (modelSelect.value) {
                    localStorage.setItem('selectedModel', modelSelect.value);
                }
                localStorage.setItem('temperature', tempSlider.value);
                localStorage.setItem('user_persona', userPersonaInput.value.trim());

                apiStatus.textContent = 'è®¾ç½®å·²ä¿å­˜ï¼';
                apiStatus.className = 'status-message success';
                apiStatus.style.display = 'block';
                setTimeout(() => apiStatus.style.display = 'none', 3000);
            });
            
            // æ¸…é™¤ç¼“å­˜
            clearCacheBtn.addEventListener('click', () => {
                if (confirm('è­¦å‘Šï¼šè¿™å°†åˆ é™¤æ‰€æœ‰è§’è‰²çš„æ‰€æœ‰èŠå¤©è®°å½•ï¼Œä¸”æ— æ³•æ¢å¤ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                    localStorage.removeItem('chats');
                    localStorage.removeItem('memories'); // åŒæ—¶æ¸…é™¤è®°å¿†
                    alert('æ‰€æœ‰èŠå¤©è®°å½•å’Œè®°å¿†å·²è¢«æ¸…é™¤ã€‚');
                }
            });

            // åˆå§‹åŠ è½½
            loadSettings();

            // =============================================================
            // ============  ç»ˆæè°ƒè¯•ç‰ˆ getModels å‡½æ•°  =====================
            // =============================================================
            fetchModelsBtn.addEventListener('click', async () => {
                const apiUrl = apiUrlInput.value.trim();
                const apiKey = apiKeyInput.value.trim();

                // 1. æ¸…ç†å·¥ä½œåŒº & åŸºæœ¬æ£€æŸ¥
                apiStatus.style.display = 'none';
                modelSelect.innerHTML = '';
                console.clear(); // æ¸…ç©ºæ§åˆ¶å°ï¼Œæ–¹ä¾¿æŸ¥çœ‹æœ¬æ¬¡æ—¥å¿—
                console.log("--- å¼€å§‹è·å–æ¨¡å‹åˆ—è¡¨ ---");

                if (!apiUrl || !apiKey) {
                    apiStatus.textContent = 'é”™è¯¯ï¼šAPI URL å’Œ API Key ä¸èƒ½ä¸ºç©ºï¼';
                    apiStatus.className = 'status-message error';
                    apiStatus.style.display = 'block';
                    console.error("é”™è¯¯ï¼šURLæˆ–Keyä¸ºç©ºã€‚");
                    return;
                }

                apiStatus.textContent = 'æ­£åœ¨è·å–...';
                apiStatus.className = 'status-message';
                apiStatus.style.display = 'block';

                // 2. å‡†å¤‡è¯·æ±‚å‚æ•° (å…³é”®è¯Šæ–­ç‚¹)
                const finalUrl = apiUrl.replace(/\/$/, '') + '/models'; // ç§»é™¤æœ«å°¾æ–œæ å¹¶æ‹¼æ¥
                const headers = {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                };
                
                console.log("è¾“å…¥çš„åŸå§‹URL:", apiUrl);
                console.log("å¤„ç†åå°†è¦è¯·æ±‚çš„å®Œæ•´URL:", finalUrl);
                console.log("è¯·æ±‚å¤´ (Headers):", headers);

                try {
                    // 3. å‘é€è¯·æ±‚
                    const response = await fetch(finalUrl, {
                        method: 'GET',
                        headers: headers
                    });

                    console.log("æ”¶åˆ°å“åº” (Response):", response);
                    
                    // 4. åˆ†æå“åº” (å…³é”®è¯Šæ–­ç‚¹)
                    const responseText = await response.text(); // å…ˆè·å–åŸå§‹æ–‡æœ¬
                    console.log("æ”¶åˆ°çš„åŸå§‹å“åº”æ–‡æœ¬:", responseText);

                    if (!response.ok) {
                         // å°è¯•è§£æJSONé”™è¯¯ä½“ï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨åŸå§‹æ–‡æœ¬
                        try {
                            const errorJson = JSON.parse(responseText);
                            throw new Error(`APIè¿”å›é”™è¯¯: ${errorJson.error?.message || responseText}`);
                        } catch {
                            throw new Error(`HTTPçŠ¶æ€ ${response.status}: ${response.statusText}`);
                        }
                    }
                    
                    // æ£€æŸ¥å“åº”æ˜¯å¦ä¸ºHTML
                    if (responseText.trim().startsWith('<')) {
                        throw new Error("è·å–å¤±è´¥: è¿”å›çš„å†…å®¹æ˜¯HTMLé¡µé¢ï¼Œä¸æ˜¯æœ‰æ•ˆçš„JSONæ•°æ®ã€‚è¯·ç¡®è®¤æ‚¨çš„API URLæ˜¯APIçš„åŸºç¡€è·¯å¾„ (Base URL)ï¼Œè€Œä¸æ˜¯ç½‘ç«™ä¸»é¡µã€‚");
                    }
                    
                    const data = JSON.parse(responseText); // ç¡®å®šä¸æ˜¯HTMLåå†è§£æ
                    const models = data.data || data; // å…¼å®¹ä¸åŒAPIæ ¼å¼ (OpenAIæ˜¯ data.data)

                    if (!Array.isArray(models) || models.length === 0) {
                        throw new Error("è·å–æˆåŠŸï¼Œä½†è¿”å›çš„æ¨¡å‹åˆ—è¡¨ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®ã€‚");
                    }

                    // 5. æˆåŠŸå¤„ç†
                    modelSelect.innerHTML = ''; // æ¸…ç©ºæ—§åˆ—è¡¨
                    models.forEach(model => {
                        // é€šå¸¸æˆ‘ä»¬åªéœ€è¦ gpt æ¨¡å‹
                        if(model.id && (model.id.includes('gpt') || model.id.includes('claude') || model.id.includes('gemini'))) {
                            const option = document.createElement('option');
                            option.value = model.id;
                            option.textContent = model.id;
                            modelSelect.appendChild(option);
                        }
                    });

                    apiStatus.textContent = `æˆåŠŸè·å– ${modelSelect.options.length} ä¸ªæ¨¡å‹ï¼`;
                    apiStatus.className = 'status-message success';

                } catch (error) {
                    console.error("æ•è·åˆ°é”™è¯¯:", error);
                    // 6. ç»Ÿä¸€é”™è¯¯å¤„ç†
                    let errorMessage = "è·å–å¤±è´¥: " + error.message;
                    if (error instanceof TypeError) { // ç½‘ç»œä¸é€šç­‰ fetch æœ¬èº«çš„é”™è¯¯
                        errorMessage = "è·å–å¤±è´¥: ç½‘ç»œé”™è¯¯æˆ–URLæ— æ³•è®¿é—®ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€ä»£ç†è®¾ç½®æˆ–URLæ‹¼å†™ã€‚";
                    }
                    apiStatus.textContent = errorMessage;
                    apiStatus.className = 'status-message error';
                } finally {
                    apiStatus.style.display = 'block'; // ç¡®ä¿æœ€ç»ˆçŠ¶æ€å¯è§
                }
            });
        });
    </script>
</body>
</html>
